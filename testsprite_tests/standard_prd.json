{
  "meta": {
    "project": "Arot Hisab",
    "date": "2026-02-14",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "Arot Hisab is a web-first calculation and transaction-record platform for fish wholesale markets that automates multi-step transaction math and provides bilingual, accessible UI. It combines instant calculation, a structured transaction table, and persistent records (Supabase) to reduce errors and speed up market operations.",
  "core_goals": [
    "Eliminate manual calculation errors by providing an automated calculation engine",
    "Increase transaction throughput and speed for market operators",
    "Provide durable digital record-keeping and easy export/search of transactions",
    "Offer a Bengali-first bilingual interface and accessibility features (font-size, themes)",
    "Support lightweight offline usage with sync and conflict handling"
  ],
  "features": [
    {
      "name": "Authentication",
      "description": "User login and registration flow that secures access to the dashboard and protected pages.",
      "user_flows": [
        "GET /auth -> Receive 200 HTML (login page) -> POST /api/auth/login with valid email/password -> Receive 200 with JWT and user_id -> GET /dashboard with Authorization: Bearer <JWT> -> Receive 200 HTML",
        "POST /api/auth/login with invalid credentials -> Receive 401 Unauthorized -> GET /auth -> Receive 200 HTML with error message"
      ]
    },
    {
      "name": "Automated Calculation Engine",
      "description": "Server-side (and client mirror) calculation of net weight, base amount and final amount (commission) given gross weight and rate per kg; supports deduction methods A/B.",
      "user_flows": [
        "POST /api/transactions with {gross_weight_kg:15.700, rate_per_kg:120.00, deduction_method:'A'} -> Receive 201 Created with calculated fields {net_weight_kg, base_amount, final_amount, commission_percent}",
        "POST /api/transactions with missing gross_weight_kg -> Receive 400 Bad Request with validation error describing required fields"
      ]
    },
    {
      "name": "Transaction Record Table",
      "description": "Structured 7-column table for creating, editing, deleting and exporting transactions; table stores seller, gross/net weight, rate, amounts, buyer and notes.",
      "user_flows": [
        "GET /transactions -> Receive 200 HTML (transactions page) -> GET /api/transactions with Authorization: Bearer <JWT> -> Receive 200 with transactions array -> POST /api/transactions with new transaction data -> Receive 201 Created with transaction id -> GET /api/transactions/:id -> Receive 200 with saved transaction",
        "DELETE /api/transactions/:id for non-existent id -> Receive 404 Not Found -> GET /api/transactions -> Receive 200 with unchanged transactions array"
      ]
    },
    {
      "name": "Bilingual Interface (Bengali/English)",
      "description": "User-selectable language toggle that updates UI labels, error messages and persisted preference.",
      "user_flows": [
        "GET /settings -> Receive 200 HTML (settings page) -> POST /api/settings with {language:'bn'} and Authorization: Bearer <JWT> -> Receive 200 with updated settings -> GET /dashboard -> Receive 200 HTML with Bengali labels and text",
        "POST /api/settings with unsupported language 'fr' -> Receive 400 Bad Request with 'unsupported language' error -> GET /settings -> Receive 200 HTML with previous language unchanged"
      ]
    },
    {
      "name": "Adjustable Font Size",
      "description": "User setting to change base font size (small/medium/large) globally and persist preference.",
      "user_flows": [
        "POST /api/settings with {font_size:'large'} and Authorization: Bearer <JWT> -> Receive 200 with updated preference -> GET /profile -> Receive 200 HTML with UI rendered in large font",
        "POST /api/settings with {font_size:'xxl'} and Authorization: Bearer <JWT> -> Receive 400 Bad Request with validation error -> GET /profile -> Receive 200 HTML with previous font_size applied"
      ]
    },
    {
      "name": "Built-in Calculator (numeric keypad / expression evaluator)",
      "description": "On-screen numeric keypad and optional expression API for quick calculations that feed transaction inputs.",
      "user_flows": [
        "POST /api/calculator/evaluate with {expression:'15.700 * 0.95 * 120 * 1.02'} and Authorization: Bearer <JWT> -> Receive 200 with {result:1825.60}",
        "POST /api/calculator/evaluate with malformed expression '15..7*' and Authorization: Bearer <JWT> -> Receive 422 Unprocessable Entity with parsing error"
      ]
    },
    {
      "name": "Deduction Method Selection",
      "description": "User or per-transaction selection between Method A (5% on total weight) and Method B (5% on kg only then add grams).",
      "user_flows": [
        "POST /api/settings with {deduction_method:'B'} and Authorization: Bearer <JWT> -> Receive 200 with updated setting -> POST /api/transactions with {gross_weight_kg:15.700, rate_per_kg:120.00} and Authorization: Bearer <JWT> -> Receive 201 Created using user's default deduction_method 'B' with calculated net_weight",
        "POST /api/settings with {deduction_method:'C'} and Authorization: Bearer <JWT> -> Receive 400 Bad Request with 'invalid deduction method' error"
      ]
    },
    {
      "name": "Transaction History (search, filter, export)",
      "description": "Persistent transaction history with search, date-range filter, sorting and export (CSV/PDF/Excel).",
      "user_flows": [
        "GET /api/transactions?start=2026-02-01&end=2026-02-14&seller=Badal with Authorization: Bearer <JWT> -> Receive 200 with filtered transactions array -> GET /api/transactions/export?format=csv&start=2026-02-01&end=2026-02-14 with Authorization: Bearer <JWT> -> Receive 200 with file URL",
        "GET /api/transactions?start=2026-02-20&end=2026-02-10 with Authorization: Bearer <JWT> -> Receive 400 Bad Request with 'invalid date range' error"
      ]
    },
    {
      "name": "Daily Summary Report",
      "description": "End-of-day aggregates showing totals for gross/net weight, base amounts, commissions and exports for sharing/printing.",
      "user_flows": [
        "GET /api/daily_summaries?date=2026-02-14 with Authorization: Bearer <JWT> -> Receive 200 with totals {total_transactions,total_gross_weight,total_net_weight,total_base_amount,total_commission} -> GET /api/daily_summaries/export?date=2026-02-14&format=pdf with Authorization: Bearer <JWT> -> Receive 200 with download URL",
        "GET /api/daily_summaries?date=1990-01-01 with Authorization: Bearer <JWT> -> Receive 404 No summary found for date"
      ]
    },
    {
      "name": "User Profiles (saved sellers/buyers)",
      "description": "Save and reuse frequently used seller/buyer contacts for quick auto-fill in transactions.",
      "user_flows": [
        "GET /api/contacts with Authorization: Bearer <JWT> -> Receive 200 with saved contacts array -> POST /api/contacts with {name:'Badal Babu', contact_type:'seller'} and Authorization: Bearer <JWT> -> Receive 201 Created with contact id",
        "POST /api/contacts with duplicate name 'Badal Babu' and Authorization: Bearer <JWT> -> Receive 409 Conflict with 'duplicate contact' error"
      ]
    },
    {
      "name": "Offline Mode & Sync",
      "description": "Local-first calculation and transaction queueing when offline, with server sync and conflict resolution when connectivity returns.",
      "user_flows": [
        "POST /api/sync/offline with Authorization: Bearer <JWT> and body {queued_transactions:[...]} -> Receive 200 with {synced:[ids], conflicts:[]} -> GET /api/transactions with Authorization: Bearer <JWT> -> Receive 200 including synced transactions",
        "POST /api/sync/offline with Authorization: Bearer <JWT> and body containing conflicting_transaction -> Receive 409 Conflict with resolution instructions -> Client shows conflict UI to user"
      ]
    },
    {
      "name": "Dashboard Page (UI entry point)",
      "description": "Authenticated dashboard page that hosts the calculation UI, quick actions, and recent transactions.",
      "user_flows": [
        "GET /dashboard with Authorization: Bearer <JWT> -> Receive 200 HTML (dashboard page with calculation UI and recent transactions) -> GET /api/transactions?limit=10 with Authorization: Bearer <JWT> -> Receive 200 with recent transactions",
        "GET /dashboard without Authorization header -> Receive 401 Unauthorized or 302 Redirect to /auth"
      ]
    },
    {
      "name": "Transactions Page (page-level)",
      "description": "Page for viewing the full transaction table and per-row actions (edit, delete, export).",
      "user_flows": [
        "GET /transactions with Authorization: Bearer <JWT> -> Receive 200 HTML -> GET /api/transactions with Authorization: Bearer <JWT> -> Receive 200 with full transactions list",
        "GET /transactions with expired session token -> Receive 401 Unauthorized -> Client redirects to /auth"
      ]
    },
    {
      "name": "Settings Page",
      "description": "Page for adjusting language, font size, deduction defaults and other preferences.",
      "user_flows": [
        "GET /settings with Authorization: Bearer <JWT> -> Receive 200 HTML -> POST /api/settings with {language:'en', font_size:'medium', deduction_method:'A'} and Authorization: Bearer <JWT> -> Receive 200 with updated settings",
        "GET /settings without Authorization header -> Receive 401 Unauthorized"
      ]
    },
    {
      "name": "Profile Page",
      "description": "User profile management page to view and update personal details and preferences.",
      "user_flows": [
        "GET /profile with Authorization: Bearer <JWT> -> Receive 200 HTML with user profile -> PUT /api/profile with {full_name:'New Name', phone:'+911234567890'} and Authorization: Bearer <JWT> -> Receive 200 with updated profile",
        "PUT /api/profile with invalid phone format '123' and Authorization: Bearer <JWT> -> Receive 400 Validation Error"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "Next.js",
      "Tailwind CSS",
      "Supabase"
    ],
    "features": [
      {
        "name": "Authentication",
        "description": "User login and registration",
        "files": [
          "src/app/auth/page.tsx"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/auth",
            "description": "Authentication page",
            "auth_required": false,
            "response_schema": {
              "200": "HTML"
            }
          }
        ]
      },
      {
        "name": "Dashboard",
        "description": "User dashboard overview",
        "files": [
          "src/app/dashboard/page.tsx"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/dashboard",
            "description": "Dashboard page",
            "auth_required": true,
            "response_schema": {
              "200": "HTML"
            }
          }
        ]
      },
      {
        "name": "Transactions",
        "description": "Manage transactions",
        "files": [
          "src/app/transactions/page.tsx"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/transactions",
            "description": "Transactions page",
            "auth_required": true,
            "response_schema": {
              "200": "HTML"
            }
          }
        ]
      },
      {
        "name": "User Settings",
        "description": "Manage user settings",
        "files": [
          "src/app/settings/page.tsx"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/settings",
            "description": "Settings page",
            "auth_required": true,
            "response_schema": {
              "200": "HTML"
            }
          }
        ]
      },
      {
        "name": "User Profile",
        "description": "Manage user profile",
        "files": [
          "src/app/profile/page.tsx"
        ],
        "endpoints": [
          {
            "method": "GET",
            "path": "/profile",
            "description": "Profile page",
            "auth_required": true,
            "response_schema": {
              "200": "HTML"
            }
          }
        ]
      }
    ],
    "known_limitations": []
  }
}
